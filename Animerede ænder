//OPGAVE 1

CREATE TABLE Duck (
	id INTEGER PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY,
	name VARCHAR(200) NOT NULL,
	show VARCHAR(200) NOT NULL,
	studio VARCHAR(200) NOT NULL,
	notes TEXT NOT NULL
);

COPY Duck(name, show, studio, notes)
FROM 'D:\list-of-fictional-ducks-in-animation-wikipedia.csv'
DELIMITER ','
CSV HEADER;


//OPGAVE 2

CREATE TABLE DuckAudits (
	id SERIAL PRIMARY KEY,
	name TEXT NOT NULL,
	notes TEXT NOT NULL,
	show TEXT NOT NULL,
	studio TEXT NOT NULL,
	changedOn TIMESTAMP(6) NOT NULL
);


//OPGAVE 3

CREATE OR REPLACE FUNCTION TF_nameChangeLog()
RETURNS TRIGGER AS
$$
BEGIN
	INSERT INTO duckaudits(name, notes, show, studio, changedOn) 
	VALUES (OLD.name, OLD.notes, OLD.show, OLD.studio, CURRENT_TIMESTAMP);
	RETURN OLD;
END;
$$
LANGUAGE PLPGSQL;


CREATE TRIGGER name_change_log
AFTER UPDATE
ON duck
FOR EACH ROW
EXECUTE FUNCTION TF_nameChangeLog()


UPDATE duck
set name = 'Testing purpose'
WHERE id = 1;
